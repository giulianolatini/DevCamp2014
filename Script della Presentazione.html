<!DOCTYPE html><html><head><meta charset="utf-8"><style>html { font-size: 100%; overflow-y: scroll; -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; }

body{
  color:#444;
  font-family:Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman',
              "Hiragino Sans GB", "STXihei", "微软雅黑", serif;
  font-size:12px;
  line-height:1.5em;
  background:#fefefe;
  width: 45em;
  margin: 10px auto;
  padding: 1em;
  outline: 1300px solid #FAFAFA;
}

a{ color: #0645ad; text-decoration:none;}
a:visited{ color: #0b0080; }
a:hover{ color: #06e; }
a:active{ color:#faa700; }
a:focus{ outline: thin dotted; }
a:hover, a:active{ outline: 0; }

span.backtick {
  border:1px solid #EAEAEA;
  border-radius:3px;
  background:#F8F8F8;
  padding:0 3px 0 3px;
}

::-moz-selection{background:rgba(255,255,0,0.3);color:#000}
::selection{background:rgba(255,255,0,0.3);color:#000}

a::-moz-selection{background:rgba(255,255,0,0.3);color:#0645ad}
a::selection{background:rgba(255,255,0,0.3);color:#0645ad}

p{
margin:1em 0;
}

img{
max-width:100%;
}

h1,h2,h3,h4,h5,h6{
font-weight:normal;
color:#111;
line-height:1em;
}
h4,h5,h6{ font-weight: bold; }
h1{ font-size:2.5em; }
h2{ font-size:2em; border-bottom:1px solid silver; padding-bottom: 5px; }
h3{ font-size:1.5em; }
h4{ font-size:1.2em; }
h5{ font-size:1em; }
h6{ font-size:0.9em; }

blockquote{
color:#666666;
margin:0;
padding-left: 3em;
border-left: 0.5em #EEE solid;
}
hr { display: block; height: 2px; border: 0; border-top: 1px solid #aaa;border-bottom: 1px solid #eee; margin: 1em 0; padding: 0; }


pre , code, kbd, samp { 
  color: #000; 
  font-family: monospace; 
  font-size: 0.88em; 
  border-radius:3px;
  background-color: #F8F8F8;
  border: 1px solid #CCC; 
}
pre { white-space: pre; white-space: pre-wrap; word-wrap: break-word; padding: 5px 12px;}
pre code { border: 0px !important; padding: 0;}
code { padding: 0 3px 0 3px; }

b, strong { font-weight: bold; }

dfn { font-style: italic; }

ins { background: #ff9; color: #000; text-decoration: none; }

mark { background: #ff0; color: #000; font-style: italic; font-weight: bold; }

sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }
sup { top: -0.5em; }
sub { bottom: -0.25em; }

ul, ol { margin: 1em 0; padding: 0 0 0 2em; }
li p:last-child { margin:0 }
dd { margin: 0 0 0 2em; }

img { border: 0; -ms-interpolation-mode: bicubic; vertical-align: middle; }

table { border-collapse: collapse; border-spacing: 0; }
td { vertical-align: top; }

@media only screen and (min-width: 480px) {
body{font-size:14px;}
}

@media only screen and (min-width: 768px) {
body{font-size:16px;}
}

@media print {
  * { background: transparent !important; color: black !important; filter:none !important; -ms-filter: none !important; }
  body{font-size:12pt; max-width:100%; outline:none;}
  a, a:visited { text-decoration: underline; }
  hr { height: 1px; border:0; border-bottom:1px solid black; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; padding-right: 1em; page-break-inside: avoid; }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page :left { margin: 15mm 20mm 15mm 10mm; }
  @page :right { margin: 15mm 10mm 15mm 20mm; }
  p, h2, h3 { orphans: 3; widows: 3; }
  h2, h3 { page-break-after: avoid; }
}
</style><title>Script della Presentazione</title></head><body><h1 id="script-di-presentazione">Script di presentazione</h1>
<h2 id="punti-da-sviluppare">Punti da sviluppare</h2>
<p>Ora che iniziamo a parlare di queste cose vediamo il sito radice di <a href="http://puppetlabs.com/" title="Puppet Labs">Puppet Labs</a> che aiuta </p>
<h3 id="frammenti-di-codice-e-comandi">Frammenti di codice e comandi</h3>
<pre><code class="bash">azure account download
</code></pre>

<p>La procedura migliore per attivare il collegamento con il proprio account Microsoft Azure è procedere come segue:</p>
<p><img alt="azure account download" src="https://raw.githubusercontent.com/giulianolatini/DevCamp2014/master/img/azure_account_download.png" /></p>
<ul>
<li>dal prompt digitare <code>azure account download</code> , verrà chiamato il browser standard di sistema che, risolta la fase di autenticazione tramite il servizio di accounting microsoft, provvederà a scaricare un file contenente le informazioni di connessione.</li>
</ul>
<p><img alt="azure account import" src="https://raw.githubusercontent.com/giulianolatini/DevCamp2014/master/img/azure_account_import.png" /></p>
<ul>
<li>
<p>tramite il comando <code>azure account import</code> importiamo nel sistema le informazioni necessarie a costruire il canale autenticato tra cui transiteranno i comandi verso il nostro account Microsoft Azure.</p>
</li>
<li>
<p>tramite il comando <code>azure vm image list</code> vediamo l'elenco delle immagini disponibili nello store per applicarlo al comando di deploy</p>
</li>
<li>b39f27a8b8c64d52b05eac6a62ebad85__Ubuntu-14_04-LTS-amd64-server-20140618.1-en-us-30GB</li>
</ul>
<pre><code class="bash">openssl req -x509 -nodes -days 365 \
-newkey rsa:2048 \
-keyout test-pp02.key \
-out test-pp02.pem

mv test-pp02.key ~/.ssh
chmod a-rwx,u+rw ~/.ssh/test-pp02.key
ssh-add ~/.ssh/test-pp02.key

azure vm create test-pp02.cloudapp.net b39f27a8b8c64d52b05eac6a62ebad85__Ubuntu-14_04-LTS-amd64-server-20140618.1-en-us-30GB wolf --location &quot;North Europe&quot; -z small -e 22 -t test-pp02.pem -P

ssh -p 22 wolf@test-pp02.cloudapp.net -c blowfish -C -X #Connessione ed apertura shell come utente wolf

sudo puppet module install thomasvandoren-etckeeper
sudo puppet module install thomasvandoren-etckeeper
sudo puppet module install jpadams-puppet_vim_env
sudo puppet module install acme/ohmyzsh
sudo puppet module install stankevich-python
sudo puppet module install puppetlabs-apache
sudo puppet module install puppetlabs-mysql
sudo puppet module install example42-php

azure vm shutdown test-pp02 # spengo la vm test-pp02
</code></pre>

<p><img alt="azure vm list" src="https://raw.githubusercontent.com/giulianolatini/DevCamp2014/master/img/azure_vm_list.png" /></p>
<p><img alt="azure vm start" src="https://raw.githubusercontent.com/giulianolatini/DevCamp2014/master/img/azure_vm_start.png" /></p>
<h3 id="script-di-installazione">Script di installazione</h3>
<pre><code class="bash">sudo -i

/usr/bin/puppet-init/puppet-enterprise-3.2.2-ubuntu-12.04-amd64/puppet-enterprise-installer

apt-get install git etckeeper

cd /etc
git init
vi /etc/etckeeper/etckeeper.conf #Modifico l'assegnazione della variabile VCS in VCS=&quot;git&quot;

git config --global user.name &quot;Administrator&quot;
git config --global user.email &quot;root@localhost.localnets&quot;
git config -l
git config --global alias.lg &quot;log --color --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset' --abbrev-commit&quot;

mkdir /var/git
git init --bare /var/git/localconf_etc.git # I Repository bare per convenzione sono indicati .git
</code></pre>

<p>Con il comando, <a href="http://git-scm.com/book/en/Git-on-the-Server-Generating-Your-SSH-Public-Key">ssh-keygen</a> genero la coppia di chiavi rsa da utilizzare per le connessioni securizzate via ssh senza la necessità di digitare la password (nel caso in cui si voglia aggiungere automaticamente le chiavi nello store di security gestito dal <code>ssh-agent</code> lasciare vuota la richiesta della passphrase)</p>
<pre><code class="txt">Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa):
Enter passphrase (empty for no passphrase): 
Enter same passphrase again:
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
bf:d5:8b:8b:48:f5:53:44:00:43:4f:33:7e:26:db:21 root@puppet-test01
The key's randomart image is:
+--[ RSA 2048]----+
|         .+.=..  |
|           = +   |
|            E =  |
|             O . |
|        S . . o  |
|         o . o   |
|        . . + .  |
|       . . + o . |
|        . o o..  |
+-----------------+
</code></pre>

<p>da aggiungere al file <code>~/.bash_profile</code> così che la chiave appena generata al login venga aggiunta automaticamente nello store gestito da ssh-agent per risolvere le problematiche di connessione securizzata senza la necessità di digitare password </p>
<pre><code class="bash">if [ -z &quot;$SSH_AUTH_SOCK&quot; ] ; then
  eval `ssh-agent -s`
  ssh-add
fi
</code></pre>

<p>Aggiungo la parte pubblica della chiave appena generata (<code>id_rsa.pub</code>) al db che openssh-server utilizza per ricavare le parti pubbliche utilizzate per decodificare la richiesta di connessione. Se la parte pubblica della propria chiave è presente, la decodifica della richiesta di accesso (codificata con la propria parte privata) ha successo, l'accesso alla shell è consentito senza la richiesta di password, l'esempio classico d'uso di questa modalità è lo scripting di attività da un sistema ad un altro remoto.</p>
<pre><code class="bash">cd ~/.ssh
cat id_rsa.pub &gt;&gt; authorized_keys

cd /etc
git remote add origin root@localhost:/var/git/localconf_etc.git
git add *
etckeeper commit &quot;First Commit&quot;
git push -u origin master
</code></pre>

<pre><code class="txt">Counting objects: 1658, done.
Compressing objects: 100% (1282/1282), done.
Writing objects: 100% (1658/1658), 902.11 KiB, done.
Total 1658 (delta 85), reused 0 (delta 0)
To root@localhost:/var/git/localconf_etc.git
 * [new branch]      master -&gt; master
Branch master set up to track remote branch master from origin.
</code></pre>

<p>Configurazione Generale</p>
<pre><code class="bash">sudo apt-get install vim-addon-manager vim-puppet vim-scripts
sudo apt-get install zsh
sudo chsh -s $(which zsh) # Modifica della shell chiamata al login
sudo apt-get install curl
sudo curl -L https://github.com/robbyrussell/oh-my-zsh/raw/master/tools/install.sh | sh
sudo apt-get install git-flow
sudo apt-get install python-pip
sudo apt-get install exuberant-ctags
sudo pip install --user git+git://github.com/Lokaltog/powerline
sudo apt-get install byobu
</code></pre>

<p>Configurazione di ViM</p>
<pre><code class="vim">set nu!
autocmd FileType html setlocal shiftwidth=2 tabstop=2
autocmd FileType python setlocal expandtab shiftwidth=4 softtabstop=4
autocmd FileType css setlocal expandtab shiftwidth=2 softtabstop=2
autocmd FileType puppet setlocal expandtab shiftwidth=2 softtabstop=2
set tabstop=4 softtabstop=4 shiftwidth=4 noexpandtab
set paste
let mapleader = &quot;,&quot;
set laststatus=2
set statusline=%{GitBranch()}
python from powerline.vim import setup as powerline_setup
python powerline_setup()
python del powerline_setup
set rtp+=~/.powerline/powerline/bindings/vim
let g:Powerline_symbols = 'fancy'
set encoding=utf-8
set t_Co=256
set fillchars+=stl:\ ,stlnc:\
set term=xterm-256color
set termencoding=utf-8
</code></pre>

<pre><code class="bash">update_system='sudo apt-get update; sudo etckeeper commit &quot;Aggiornamento Quotidiano&quot;; sudo apt-get upgrade; sudo apt-get dist-upgrade; sudo apt-get check; sudo apt-get autoremove; sudo apt-get autoclean'
</code></pre>

<p>Configurazione base per un cloud-service <a href="https://www.opencpu.org/">OpenCPU</a> su Ubuntu 14.04 LTS</p>
<pre><code class="bash">sudo apt-get install software-properties-common
sudo add-apt-repository ppa:opencpu/opencpu-1.4
sudo apt-get update
sudo apt-get install opencpu  
</code></pre>

<p>Configurazione servizio di Voting On-line <a href="http://documentation.heliosvoting.org/">HELIOS</a></p>
<pre><code class="bash">apt-get install postgresql
apt-get install python-psycopg2
apt-get install python-django
su - postgres
createuser --superuser &lt;$whoami&gt;
exit
cd /usr/local/share
git clone --recursive git://github.com/benadida/helios-server.git
git clone http://github.com/openid/python-openid
cd python-openid
sudo python setup.py install
apt-get install python-setuptools
easy_install south
apt-get install rabbitmq-server
easy_install celery
easy_install django-celery
apt-get install python-virtualenv
cd /usr/local/share/helios-server
virtualenv venv
source venv/bin/activate
apt-get install postgresql-server-dev-all
pip install -r requirements.txt

</code></pre>

<p>Aggiungo il modulo puppet per gestire le infrastrutture in azure <a href="https://forge.puppetlabs.com/msopentech/windowsazure" title="msopentech/windowsazure">windowsazure#help</a>.</p>
<pre><code class="bash">puppet module install msopentech-windowsazure
etckeeper commit &quot;Add Microsoft Azure Puppet module for manage&quot;


</code></pre>

<p>Step 4. Get the PE console user name.
Run sudo grep ‘auth_user_email’ /etc/puppetlabs/installer/answers.install. Then, locate the user name in the answer file at this setting: q_puppet_enterpriseconsole_auth_user_email.
The user name is admin@<VM name>.cloudapp.net. For example,admin@pe-demo.cloudapp.net.</p>
<p>Step 5. Get the console password.
Run sudo grep ‘auth_password’ /etc/puppetlabs/installer/database_info.install Locate the setting, q_puppet_enterpriseconsole_auth_password, which has the password appended to it.
It looks similar to this: q_puppet_enterpriseconsole_auth_password=thos9Greu.
Copy the password for use in step 6.</p>
<p>pe-demo01.cloudapp.net</p>
<h2 id="bibliografia">Bibliografia</h2>
<p><a href="http://puppetlabs.com/" title="Puppet Labs">Puppet Labs</a>: Sito ufficiale.</p></body></html>